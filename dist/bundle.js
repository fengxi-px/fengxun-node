(()=>{var e={332:(e,s,t)=>{const a=t(699);var n=t(829);const{secretkey:r}=t(25).userToken;e.exports=async(e,s)=>{const t=a(e.req);if(!t||!t.name)throw{msg:"没有登陆, 没有访问权限",code:401};try{var i=n.verify(t.name,r)}catch(e){if("TokenExpiredError"===e.name)throw{msg:"token已过期，请重新登录",code:401};throw{msg:"没有访问权限",code:401}}e.auth={uid:i.uid},await s()}},136:(e,s,t)=>{const{Sequelize:a}=t(31),{database:n,userName:r,password:i,host:o}=t(25).db,d=new a(n,r,i,{host:o,dialect:"mysql",logging:!1,define:{freezeTableName:!0},timezone:"+08:00",sync:{force:!1}});d.sync(),e.exports=d},25:e=>{e.exports={db:{database:"fengxun",userName:"fengxun",password:"H26iKkRJSNipZd6K",host:"47.76.36.248"},weixin:{appid:"wx18599d3f74609799",secret:"326b76c544a5b714da7b3b76afac1520",code2session:"https://api.weixin.qq.com/sns/jscode2session"},zhipu:{apiKey:"a0d9368f791741b9aec663bdc94a79e8.Uy6lLXWjk0rK3lwI"},aliyun:{accessKeyID:"LTAI5tFg1a9TFoFKoshQHTXi",accessKeySecret:"iQS9IGUDtDh8poUtJX6YlYChHNF5o1"},userToken:{secretkey:"dhvgdfytrytuui687990",expiresIn:864e4},redisInfo:{port:6379,host:"47.76.36.248",password:"123456"}}},228:(e,s,t)=>{const a=t(629);e.exports=async(e,s)=>{try{await s()}catch(s){if(a.error("捕获到异常错误",s),console.log(s),s.code){const{code:t,msg:a,error:n}=s,r=n||null;e.send(null,t,a,r)}else if(s.error){const{message:t,code:a}=s.error;e.send(null,200,"SUCCESS",t,a)}else{const t=s.message||"异常错误,请查看服务器端日志",a=s.status||s.statusCode||500;e.send(null,a,"服务器端异常错误",t)}}}},529:(e,s,t)=>{var a=t(829);const{secretkey:n,expiresIn:r}=t(25).userToken;e.exports=function(e){return a.sign({uid:e},n,{expiresIn:r})}},145:e=>{e.exports=async(e,s)=>{e.send=(s=null,t=200,a="SUCCESS",n=null,r=0)=>{e.body={data:s,msg:a,error:n,serviceCode:r},e.status=t},await s()}},808:(e,s,t)=>{const a=t(386),n=t(411);e.exports=new class{async addRole(e,s){const{name:t,permission:r}=e.request.body;await a.emptyCheck(t,"请输入角色名称","name"),await a.emptyCheck(r,"请输入角色权限","permission");const i=(await n.create({name:t,permission:r})).id;e.send({id:i})}async getRoles(e,s){const t=await n.findAll();e.send(t)}async getRole(e,s){const{id:t}=e.request.query,a=await n.findOne({where:{id:t}});a?e.send(a):e.send("角色不存在")}async updateRole(e,s){const{id:t}=e.request.query,{name:r,permission:i}=e.request.body;await a.emptyCheck(r,"请输入角色名称","name"),await a.emptyCheck(i,"请输入角色权限","permission"),await n.findOne({where:{id:t}})?(await n.update({name:r,permission:i},{where:{id:t}}),e.send("更新成功")):e.send("角色不存在")}async deleteRole(e,s){const{id:t}=e.request.query;await n.findOne({where:{id:t}})?(await n.destroy({where:{id:t}}),e.send("删除成功")):e.send("角色不存在")}async findRoleByName(e,s){const{name:t}=e.request.query,a=await n.findOne({where:{name:t}});a?e.send(a):e.send("角色不存在")}async findRoleById(e,s){const{id:t}=e.request.query,a=await n.findOne({where:{id:t}});a?e.send(a):e.send("角色不存在")}async findRole(e,s){const{id:t,name:a}=e.request.query;let r={};t&&(r.id=t),a&&(r.name=a);const i=await n.findAll({where:r});0!==i.length?e.send(i):e.send("角色不存在")}}},603:(e,s,t)=>{const a=t(386),n=t(268),r=t(529),i=t(411);e.exports=new class{async login(e,s){const{nickname:t,email:o,password:d}=e.request.body;let c=-1;await a.emptyCheck(t,"请输入昵称","nickname"),await a.emptyCheck(o,"请输入邮箱","email"),await a.emptyCheck(d,"请输入密码","password");const l=await n.findOne({where:{email:o}});if(l)if(l.password!==d||l.nickname!==t)e.send("密码错误");else{c=l.id;const{role:s,avatar:a}=l,n=await i.findOne({where:{name:s}});e.send({token:r(o),nickname:t,id:c,email:o,role:s,avatar:a,permissions:n.permission})}else{console.log("创建用户");const s=await n.create({nickname:t,email:o,password:d,role:"default user",avatar:"https://kecheng-chabaidao.oss-cn-hangzhou.aliyuncs.com/kecheng/1736844800237248.jpeg"});c=s.id;const{role:a,avatar:i}=s;e.send({token:r(o),nickname:t,id:c,email:o,role:a,avatar:i})}}async getUserInfo(e,s){const{id:t}=e.request.query;await a.emptyCheck(t,"请输入ID","useId"),console.log(t,"id");const o=await n.findOne({where:{id:t}}),{nickname:d,role:c,avatar:l,email:m}=o,u=await i.findOne({where:{name:c}});console.log(u,"roleInfo.permission",c,t),e.send({token:r(m),nickname:d,id:t,email:m,role:c,avatar:l,permissions:u.permission})}async getUsers(e,s){const t=await n.findAll();e.send(t)}async update(e,s){const{id:t}=e.request.query,{nickname:r,avatar:i,role:o,email:d,phone:c}=e.request.body;await a.emptyCheck(r,"请输入昵称","nickname"),await a.emptyCheck(d,"请输入邮箱","email"),await a.emptyCheck(o,"请输入角色","role"),await a.emptyCheck(i,"请输入头像","avatar"),await n.findOne({where:{id:t}})?(await n.update({nickname:r,avatar:i,role:o,email:d,phone:c},{where:{id:t}}),e.send("更新成功")):e.send("用户不存在")}async delete(e,s){const{id:t}=e.request.query;await n.findOne({where:{id:t}})?(await n.destroy({where:{id:t}}),e.send("删除成功")):e.send("用户不存在")}async findUserByName(e,s){const{nickname:t}=e.request.query,a=await n.findOne({where:{nickname:t}});a?e.send(a):e.send("用户不存在")}async findUserById(e,s){const{id:t}=e.request.query;let a=await n.findOne({where:{id:t}});a?e.send(a):e.send("用户不存在")}async findUser(e,s){const{id:t,nickname:a}=e.request.query;let r={};t&&(r.id=t),a&&(r.nickname=a);const i=await n.findAll({where:r});0!==i.length?e.send(i):e.send("用户不存在")}}},608:(e,s,t)=>{const a=t(386),n=t(924),{Op:r}=t(31);e.exports=new class{async getUsers(e,s){const t=await n.findAll();e.send(t)}async updateUser(e,s){const{id:t}=e.request.query,{nickname:r,avatar:i,createdAt:o,updatedAt:d}=e.request.body;await a.emptyCheck(r,"请输入昵称","nickname"),await a.emptyCheck(i,"请输入头像","avatar"),await a.emptyCheck(o,"请输入创建时间","created"),await a.emptyCheck(d,"请输入更新时间","updated"),await n.findOne({where:{id:t}})?(await n.update({nickname:r,avatar:i,createdAt:o,updatedAt:d},{where:{id:t}}),e.send("更新成功")):e.send("用户不存在")}async deleteUser(e,s){const{id:t}=e.request.query;await n.findOne({where:{id:t}})?(await n.destroy({where:{id:t}}),e.send("删除成功")):e.send("用户不存在")}async findUserByName(e,s){const{nickname:t}=e.request.query,a=await n.findAll({where:{nickname:t}});a?e.send(a):e.send("用户不存在")}async findUserById(e,s){const{id:t}=e.request.query,a=await n.findAll({where:{id:t}});a?e.send(a):e.send("用户不存在")}async findUserByTime(e,s){const{startTime:t,endTime:a}=e.request.query,i=await n.findAll({where:{createdAt:{[r.between]:[new Date(new Date(t).setHours(0,0,0,0)),new Date(new Date(a).setHours(23,59,59,999))]}}});0!==i.length?e.send(i):e.send("用户不存在")}async findUser(e,s){const{id:t,nickname:a,startTime:i,endTime:o}=e.request.query;let d={};t&&(d.id=t),a&&(d.nickname=a),i&&o&&(d.createdAt={[r.between]:[new Date(new Date(i).setHours(0,0,0,0)),new Date(new Date(o).setHours(23,59,59,999))]});const c=await n.findAll({where:d});0!==c.length?e.send(c):e.send("用户不存在")}async getRecords(e,s){const{id:t}=e.request.query,a=`chat:${(await n.findOne({where:{id:t}})).openid}`,r=await e.redis.zrevrange(a,0,-1);let i=new Map;for(const e of r){const s=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8);i.has(s)?i.set(s,i.get(s)+1):i.set(s,1)}e.send(Object.fromEntries(i))}}},677:(e,s,t)=>{const a=t(386),n=t(667),{Op:r}=t(31);e.exports=new class{async getUsers(e,s){const t=await n.findAll();e.send(t)}async updateUser(e,s){const{id:t}=e.request.query,{email:r,avatar:i,createdAt:o,updatedAt:d}=e.request.body;await a.emptyCheck(r,"请输入邮箱","email"),await a.emptyCheck(i,"请输入头像","avatar"),await a.emptyCheck(o,"请输入创建时间","created"),await a.emptyCheck(d,"请输入更新时间","updated"),await n.findOne({where:{id:t}})?await n.findOne({where:{email:r}})?e.send("邮箱已存在"):(await n.update({email:r,avatar:i,createdAt:o,updatedAt:d},{where:{id:t}}),e.send("更新成功")):e.send("用户不存在")}async deleteUser(e,s){const{id:t}=e.request.query;await n.findOne({where:{id:t}})?(await n.destroy({where:{id:t}}),e.send("删除成功")):e.send("用户不存在")}async findUserByEmail(e,s){const{email:t}=e.request.query,a=await n.findAll({where:{email:t}});a?e.send(a):e.send("用户不存在")}async findUserById(e,s){const{id:t}=e.request.query,a=await n.findAll({where:{id:t}});a?e.send(a):e.send("用户不存在")}async findUserByTime(e,s){const{startTime:t,endTime:a}=e.request.query,i=await n.findAll({where:{createdAt:{[r.between]:[new Date(new Date(t).setHours(0,0,0,0)),new Date(new Date(a).setHours(23,59,59,999))]}}});0!==i.length?e.send(i):e.send("用户不存在")}async findUser(e,s){const{id:t,email:a,startTime:i,endTime:o}=e.request.query;console.log(t,a,i,o,"id, email, startTime, endTime");let d={};t&&(d.id=t),a&&(d.email=a),i&&o&&(console.log(i,o),d.createdAt={[r.between]:[new Date(new Date(i).setHours(0,0,0,0)),new Date(new Date(o).setHours(23,59,59,999))]});const c=await n.findAll({where:d});0!==c.length?e.send(c):e.send("用户不存在")}async getRecords(e,s){const{id:t}=e.request.query,a=`chat:${(await n.findOne({where:{id:t}})).email}`,r=await e.redis.zrevrange(a,0,-1);let i=new Map;for(const e of r){const s=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8);i.has(s)?i.set(s,i.get(s)+1):i.set(s,1)}e.send(Object.fromEntries(i))}}},348:(e,s,t)=>{const a=t(386),n=t(293),r=t(982),i=t(639);e.exports=new class{async saveChatHistory(e){const{messages:s,sessionId:t}=e.request.body;await a.arrayCheck(s,"请上传聊天记录","messages");let o="";o=t||n().format("YYYYMMDD")+n().format("HHmmssSSS");const d=e.auth.uid,c=n().format("YYYY-MM-DD"),l=n().valueOf(),m=`chat:${d}`,u=r.randomUUID(),p=JSON.stringify({time:c,messageId:u,...s});e.redis.zadd(m,l,o);const y=`chat:${d}:${o}`;if(e.redis.zadd(y,l,p),t)e.send();else{const s=await new i(e).newChatHistory(d,o);e.send(s)}}async fetchChatHistory(e){const s=e.auth.uid,t=`chat:${s}`,a=await e.redis.zrevrange(t,0,-1);let n=[];for(const t of a){const a=(await e.redis.zrange(`chat:${s}:${t}`,0,-1)).map((e=>JSON.parse(e)))[0],r=a.time,i={session_id:t,message:[{content:a[0].content,role:a[0].role}],time:r};n.push(i)}e.send(n)}async onliChatHistory(e){const{sessionId:s}=e.query;await a.undefinedCheck(s,"缺少会话id值","sessionId");const t=`chat:${e.auth.uid}:${s}`,n=(await e.redis.zrange(t,0,-1)).map((e=>JSON.parse(e))),r=[];n.forEach((e=>{Object.keys(e).forEach((s=>{"time"!==s&&"messageId"!==s&&r.push(e[s])}))})),e.send(r)}}},959:(e,s,t)=>{const a=t(386),n=t(924),r=t(682),i=t(529);e.exports=new class{async login(e,s){const{nickName:t,avatar:o,code:d}=e.request.body;await a.emptyCheck(t,"请输入昵称","nickName"),await a.emptyCheck(o,"请上传头像","avatar"),await a.emptyCheck(d,"缺少code","code"),console.log(t,o,d);const c=await(new r).getOpenid(d);await n.findOne({where:{openid:c}})||(console.log("创建用户"),await n.create({openid:c,nickname:t,avatar:o})),console.log(c,"openid"),e.send({token:i(c),nickName:t,avatar:o})}}},316:(e,s,t)=>{var a=t(623).RPCClient;const{accessKeyID:n,accessKeySecret:r}=t(25).aliyun,i=t(293);var o=new a({accessKeyId:n,accessKeySecret:r,endpoint:"http://nls-meta.cn-shanghai.aliyuncs.com",apiVersion:"2019-02-28"});e.exports=new class{async aliToken(e){const s=await e.redis.get("aliToken");if(s)return e.send(s),!1;const t=await o.request("CreateToken");if(t.Token&&t.Token.Id){const s=t.Token.ExpireTime-i().unix();await e.redis.set("aliToken",t.Token.Id,"EX",s),e.send(t.Token.Id)}else e.send(null,500,"获取阿里云token失败",t)}}},221:(e,s,t)=>{const a=t(386),n=t(293),r=t(982),i=t(639);e.exports=new class{async saveChatHistory(e){const{messages:s,sessionId:t}=e.request.body;await a.arrayCheck(s,"请上传聊天记录","messages");let o="";o=t||n().format("YYYYMMDD")+n().format("HHmmssSSS");const d=e.auth.uid,c=n().format("YYYY-MM-DD"),l=n().valueOf(),m=`chat:${d}`,u=r.randomUUID(),p=JSON.stringify({time:c,messageId:u,...s});e.redis.zadd(m,l,o);const y=`chat:${d}:${o}`;if(e.redis.zadd(y,l,p),t)e.send();else{const s=await new i(e).newChatHistory(d,o);e.send(s)}}async fetchChatHistory(e){const s=e.auth.uid,t=`chat:${s}`,a=await e.redis.zrevrange(t,0,-1);let n=[];for(const t of a){const a=(await e.redis.zrange(`chat:${s}:${t}`,0,-1)).map((e=>JSON.parse(e)))[0],r=a.time,i={session_id:t,message:[{content:a[0].content,role:a[0].role}],time:r};n.push(i)}e.send(n)}async onliChatHistory(e){const{sessionId:s}=e.query;await a.undefinedCheck(s,"缺少会话id值","sessionId");const t=`chat:${e.auth.uid}:${s}`,n=(await e.redis.zrange(t,0,-1)).map((e=>JSON.parse(e))),r=[];n.forEach((e=>{Object.keys(e).forEach((s=>{"time"!==s&&"messageId"!==s&&r.push(e[s])}))})),e.send(r)}async deleteChatHistory(e){const{sessionId:s}=e.query;await a.undefinedCheck(s,"缺少会话id值","sessionId");const t=e.auth.uid,n=`chat:${t}`,r=`chat:${t}:${s}`;await e.redis.del(r),await e.redis.zrem(n,s),e.send("success")}}},468:(e,s,t)=>{const a=t(386),n=t(667),r=t(529);e.exports=new class{async login(e,s){let t=-1;const{email:i,password:o}=e.request.body;await a.emptyCheck(i,"请输入邮箱","email"),await a.emptyCheck(o,"请输入密码","password");const d=await n.findOne({where:{email:i}});if(!d)return t=(await n.create({email:i,password:o,avatar:"https://kecheng-chabaidao.oss-cn-hangzhou.aliyuncs.com/kecheng/1736844800237248.jpeg"})).id,void e.send({token:r(i),id:t,email:i,avatar});if(d.password!==o||d.email!==i)e.send("密码错误");else{t=d.id;const{avatar:s}=d;e.send({token:r(i),id:t,email:i,avatar:s})}}}},163:(e,s,t)=>{const{ZhipuAI:a}=t(304),{apiKey:n}=t(25).zhipu,r=t(386),i=new a({apiKey:n});e.exports=new class{async createCompletions(e){const{messages:s}=e.request.body;await r.arrayCheck(s,"缺少对话信息","messages");const t=await i.createCompletions({model:"glm-4-flash",messages:s,stream:!0,tools:[{type:"web_search",web_search:{enable:!0,search_result:!1}}]});e.status=200;for await(const s of t)e.res.write(s)}async createImages(e){const{prompt:s}=e.request.body;await r.emptyCheck(s,"请输入图像的文本描述","prompt");const t=await i.createImages({model:"cogview-3-flash",prompt:s});e.send({url:t.data[0].url,prompt:"我已为你生成对应的图片,你可以继续问我!"})}}},346:(e,s,t)=>{const{ZhipuAI:a}=t(304),{apiKey:n}=t(25).zhipu,r=t(386),i=new a({apiKey:n});e.exports=new class{async createCompletions(e){const{messages:s}=e.request.body;await r.arrayCheck(s,"缺少对话信息","messages");const t=await i.createCompletions({model:"glm-4-flash",messages:s,stream:!0,tools:[{type:"web_search",web_search:{enable:!0,search_result:!1}}]});e.status=200;for await(const s of t)e.res.write(s)}async createImages(e){const{prompt:s}=e.request.body;await r.emptyCheck(s,"请输入图像的文本描述","prompt");const t=await i.createImages({model:"cogview-3-flash",prompt:s});e.send({url:t.data[0].url,prompt:"我已为你生成对应的图片,你可以继续问我!"})}}},629:(e,s,t)=>{const a=t(977),n={trace:a.levels.TRACE,debug:a.levels.DEBUG,info:a.levels.INFO,warn:a.levels.WARN,error:a.levels.ERROR,fatal:a.levels.FATAL};a.configure({appenders:{console:{type:"console"},info:{type:"file",filename:"logs/info-logs.log"},error:{type:"dateFile",filename:"logs/error",pattern:"yyyy-MM-dd.log",alwaysIncludePattern:!0}},categories:{default:{appenders:["console"],level:"debug"},info:{appenders:["info","console"],level:"info"},error:{appenders:["error","console"],level:"error"}}}),s.debug=e=>{let s=a.getLogger("debug");s.level=n.debug,s.debug(e)},s.info=e=>{let s=a.getLogger("info");s.level=n.info,s.info(e)},s.warn=e=>{let s=a.getLogger("warn");s.level=n.warn,s.warn(e)},s.error=e=>{let s=a.getLogger("error");s.level=n.error,s.error(e)}},411:(e,s,t)=>{const a=t(136),{DataTypes:n}=t(31),r=a.define("role-admin",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},name:{type:n.STRING,unique:!0,allowNull:!1},permission:{type:n.STRING,allowNull:!1}});e.exports=r},268:(e,s,t)=>{const a=t(136),{DataTypes:n}=t(31),r=a.define("user-admin",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},nickname:{type:n.STRING,allowNull:!1},email:{type:n.STRING,allowNull:!1,unique:!0},password:{type:n.STRING,allowNull:!1},role:{type:n.STRING,allowNull:!1},avatar:{type:n.STRING,allowNull:!0},phone:{type:n.STRING,allowNull:!0}});e.exports=r},924:(e,s,t)=>{const a=t(136),{DataTypes:n}=t(31),r=(t(293),a.define("user-info",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},nickname:{type:n.STRING,allowNull:!1},avatar:{type:n.STRING,allowNull:!1},openid:{type:n.STRING,allowNull:!1,unique:!0}}));e.exports=r},667:(e,s,t)=>{const a=t(136),{DataTypes:n}=t(31),r=a.define("user-web",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},email:{type:n.STRING,allowNull:!1,unique:!0},password:{type:n.STRING,allowNull:!1},avatar:{type:n.STRING,allowNull:!0}});e.exports=r},692:(e,s,t)=>{const a=t(643),n=t(959),r=t(346),i=t(316),o=t(348),d=t(332),c=new a;c.post("/login",n.login),c.post("/createCompletions",r.createCompletions),c.post("/createImages",d,r.createImages),c.get("/alitoken",i.aliToken),c.post("/save-chat-history",d,o.saveChatHistory),c.get("/fetch-chat-history",d,o.fetchChatHistory),c.get("/only-chat-history",d,o.onliChatHistory);const l=t(468),m=t(163),u=t(221);c.post("/web/login",l.login),c.post("/web/createCompletions",d,m.createCompletions),c.post("/web/createImages",d,m.createImages),c.post("/web/save-chat-history",d,u.saveChatHistory),c.get("/web/fetch-chat-history",d,u.fetchChatHistory),c.get("/web/only-chat-history",d,u.onliChatHistory),c.delete("/web/delete-chat-history",d,u.deleteChatHistory);const p=t(603),y=t(608),w=t(808),h=t(677);c.post("/admin/login",p.login),c.get("/admin/getUsers",d,p.getUsers),c.post("/admin/update",d,p.update),c.delete("/admin/delete",d,p.delete),c.get("/admin/findUserByName",d,p.findUserByName),c.get("/admin/findUserById",d,p.findUserById),c.get("/admin/findUser",d,p.findUser),c.get("/admin/getUserInfo",d,p.getUserInfo),c.get("/admin/getUsersWX",d,y.getUsers),c.post("/admin/updateWX",d,y.updateUser),c.delete("/admin/deleteWX",d,y.deleteUser),c.get("/admin/findUserWXByName",d,y.findUserByName),c.get("/admin/findUserWXById",d,y.findUserById),c.get("/admin/findUserWXByTime",d,y.findUserByTime),c.get("/admin/findUserWX",d,y.findUser),c.get("/admin/getRecords",d,y.getRecords),c.get("/admin/getUsersWeb",d,h.getUsers),c.post("/admin/updateWeb",d,h.updateUser),c.delete("/admin/deleteWeb",d,h.deleteUser),c.get("/admin/findUserWebByEmail",d,h.findUserByEmail),c.get("/admin/findUserWebById",d,h.findUserById),c.get("/admin/findUserWebByTime",d,h.findUserByTime),c.get("/admin/findUserWeb",d,h.findUser),c.get("/admin/getUserWebRecords",d,h.getRecords),c.post("/admin/addRole",d,w.addRole),c.get("/admin/getRoles",d,w.getRoles),c.post("/admin/updateRole",d,w.updateRole),c.delete("/admin/deleteRole",d,w.deleteRole),c.get("/admin/findRoleByName",d,w.findRoleByName),c.get("/admin/findRoleById",d,w.getRole),c.get("/admin/findRole",d,w.findRole),e.exports=c},639:e=>{e.exports=class{constructor(e){this.ctx=e}async newChatHistory(e,s){const t=(await this.ctx.redis.zrange(`chat:${e}:${s}`,0,-1)).map((e=>JSON.parse(e)))[0],a=t.time;return{session_id:s,message:[{content:t[0].content,role:t[0].role}],time:a}}}},682:(e,s,t)=>{const{appid:a,secret:n,code2session:r}=t(25).weixin,i=t(480),o=t(938);t(924),e.exports=class{async getOpenid(e){const s=i.stringify({appid:a,secret:n,js_code:e,grant_type:"authorization_code"}),t=await o.get(`${r}?${s}`);if(t.data.errcode)throw{msg:"获取code出错",code:400,error:t.data};return t.data.openid}}},386:e=>{e.exports=new class{async undefinedCheck(e,s){if(void 0===e)throw console.log("校验不通过"),{msg:`${s}字段必填`,code:400}}async emptyCheck(e,s,t){if(await this.undefinedCheck(e,t),"string"!=typeof e)throw{msg:`${t}字段必须为字符串类型`,code:400};if(""===e.trim())throw{msg:s,code:422}}async arrayCheck(e,s,t){if(await this.undefinedCheck(e,t),!Array.isArray(e))throw{msg:`${t}字段必须为数组类型`,code:400};if(e.length<=0)throw{msg:s,code:422}}}},623:e=>{"use strict";e.exports=require("@alicloud/pop-core")},695:e=>{"use strict";e.exports=require("@koa/cors")},643:e=>{"use strict";e.exports=require("@koa/router")},938:e=>{"use strict";e.exports=require("axios")},699:e=>{"use strict";e.exports=require("basic-auth")},293:e=>{"use strict";e.exports=require("dayjs")},659:e=>{"use strict";e.exports=require("ioredis")},829:e=>{"use strict";e.exports=require("jsonwebtoken")},101:e=>{"use strict";e.exports=require("koa")},911:e=>{"use strict";e.exports=require("koa-bodyparser")},546:e=>{"use strict";e.exports=require("koa-json")},977:e=>{"use strict";e.exports=require("log4js")},577:e=>{"use strict";e.exports=require("module-alias")},31:e=>{"use strict";e.exports=require("sequelize")},304:e=>{"use strict";e.exports=require("zhipuai-sdk-nodejs-v4")},982:e=>{"use strict";e.exports=require("crypto")},480:e=>{"use strict";e.exports=require("querystring")}},s={};function t(a){var n=s[a];if(void 0!==n)return n.exports;var r=s[a]={exports:{}};return e[a](r,r.exports,t),r.exports}const a=t(101),n=t(546),r=t(911),i=t(695),o=t(659),{addAliases:d}=t(577);d({"@":__dirname});const c=t(692),l=t(145),m=t(228),u=new a;u.use(i()),u.use(n()),u.use(r()),u.use(l),u.use(m);const{port:p,host:y,password:w}=t(25).redisInfo,h=new o({port:p,host:y,password:w});u.use((async(e,s)=>{e.redis=h,await s()})),u.use(c.routes()).use(c.allowedMethods()),u.listen(3e3,(()=>{console.log("Server is running on port 3000")}))})();