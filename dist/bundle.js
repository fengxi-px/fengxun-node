(()=>{var e={332:(e,t,s)=>{const a=s(699);var n=s(829);const{secretkey:i}=s(25).userToken;e.exports=async(e,t)=>{const s=a(e.req);if(!s||!s.name)throw{msg:"没有登陆, 没有访问权限",code:401};try{var r=n.verify(s.name,i)}catch(e){if("TokenExpiredError"===e.name)throw{msg:"token已过期，请重新登录",code:401};throw{msg:"没有访问权限",code:401}}e.auth={uid:r.uid},await t()}},136:(e,t,s)=>{const{Sequelize:a}=s(31),{database:n,userName:i,password:r,host:o}=s(25).db,d=new a(n,i,r,{host:o,dialect:"mysql",logging:!1,define:{freezeTableName:!0},timezone:"+08:00",sync:{force:!1}});d.sync(),e.exports=d},25:e=>{e.exports={db:{database:"fengxun",userName:"fengxun",password:"H26iKkRJSNipZd6K",host:"47.76.36.248"},weixin:{appid:"wx18599d3f74609799",secret:"326b76c544a5b714da7b3b76afac1520",code2session:"https://api.weixin.qq.com/sns/jscode2session"},zhipu:{apiKey:"a0d9368f791741b9aec663bdc94a79e8.Uy6lLXWjk0rK3lwI"},aliyun:{accessKeyID:"LTAI5tFg1a9TFoFKoshQHTXi",accessKeySecret:"iQS9IGUDtDh8poUtJX6YlYChHNF5o1"},userToken:{secretkey:"dhvgdfytrytuui687990",expiresIn:864e4},redisInfo:{port:6379,host:"47.76.36.248",password:"123456"}}},228:(e,t,s)=>{const a=s(629);e.exports=async(e,t)=>{try{await t()}catch(t){if(a.error("捕获到异常错误",t),console.log(t),t.code){const{code:s,msg:a,error:n}=t,i=n||null;e.send(null,s,a,i)}else if(t.error){const{message:s,code:a}=t.error;e.send(null,200,"SUCCESS",s,a)}else{const s=t.message||"异常错误,请查看服务器端日志",a=t.status||t.statusCode||500;e.send(null,a,"服务器端异常错误",s)}}}},529:(e,t,s)=>{var a=s(829);const{secretkey:n,expiresIn:i}=s(25).userToken;e.exports=function(e){return a.sign({uid:e},n,{expiresIn:i})}},145:e=>{e.exports=async(e,t)=>{e.send=(t=null,s=200,a="SUCCESS",n=null,i=0)=>{e.body={data:t,msg:a,error:n,serviceCode:i},e.status=s},await t()}},808:(e,t,s)=>{const a=s(386),n=s(411);e.exports=new class{async addRole(e,t){const{name:s,permission:i}=e.request.body;await a.emptyCheck(s,"请输入角色名称","name"),await a.emptyCheck(i,"请输入角色权限","permission");const r=(await n.create({name:s,permission:i})).id;e.send({id:r})}async getRoles(e,t){const s=await n.findAll();e.send(s)}async getRole(e,t){const{id:s}=e.request.query,a=await n.findOne({where:{id:s}});a?e.send(a):e.send("角色不存在")}async updateRole(e,t){const{id:s}=e.request.query,{name:i,permission:r}=e.request.body;await a.emptyCheck(i,"请输入角色名称","name"),await a.emptyCheck(r,"请输入角色权限","permission"),await n.findOne({where:{id:s}})?(await n.update({name:i,permission:r},{where:{id:s}}),e.send("更新成功")):e.send("角色不存在")}async deleteRole(e,t){const{id:s}=e.request.query;await n.findOne({where:{id:s}})?(await n.destroy({where:{id:s}}),e.send("删除成功")):e.send("角色不存在")}async findRoleByName(e,t){const{name:s}=e.request.query,a=await n.findOne({where:{name:s}});a?e.send(a):e.send("角色不存在")}async findRoleById(e,t){const{id:s}=e.request.query,a=await n.findOne({where:{id:s}});a?e.send(a):e.send("角色不存在")}async findRole(e,t){const{id:s,name:a}=e.request.query;let i={};s&&(i.id=s),a&&(i.name=a);const r=await n.findAll({where:i});0!==r.length?e.send(r):e.send("角色不存在")}}},603:(e,t,s)=>{const a=s(386),n=s(268),i=s(529),r=s(411),o=s(333);e.exports=new class{async login(e,t){const{nickname:s,email:o,password:d}=e.request.body;let c=-1;await a.emptyCheck(s,"请输入昵称","nickname"),await a.emptyCheck(o,"请输入邮箱","email"),await a.emptyCheck(d,"请输入密码","password");const l=await n.findOne({where:{email:o}});if(l)if(l.password!==d||l.nickname!==s)e.send("密码错误");else{c=l.id;const{role:t,avatar:a}=l,n=await r.findOne({where:{name:t}});e.send({token:i(o),nickname:s,id:c,email:o,role:t,avatar:a,permissions:n.permission})}else{console.log("创建用户");const t=await n.create({nickname:s,email:o,password:d,role:"default user",avatar:"https://kecheng-chabaidao.oss-cn-hangzhou.aliyuncs.com/kecheng/1736844800237248.jpeg"});c=t.id;const{role:a,avatar:r}=t;e.send({token:i(o),nickname:s,id:c,email:o,role:a,avatar:r})}}async getUserInfo(e,t){const{id:s}=e.request.query;await a.emptyCheck(s,"请输入ID","useId");const o=await n.findOne({where:{id:s}}),{nickname:d,role:c,avatar:l,email:m}=o,u=await r.findOne({where:{name:c}});e.send({token:i(m),nickname:d,id:s,email:m,role:c,avatar:l,permissions:u.permission})}async getUsers(e,t){const s=await n.findAll();e.send(s)}async update(e,t){const{id:s}=e.request.query,{nickname:i,avatar:r,role:o,email:d,phone:c}=e.request.body;await a.emptyCheck(i,"请输入昵称","nickname"),await a.emptyCheck(d,"请输入邮箱","email"),await a.emptyCheck(o,"请输入角色","role"),await a.emptyCheck(r,"请输入头像","avatar"),await n.findOne({where:{id:s}})?(await n.update({nickname:i,avatar:r,role:o,email:d,phone:c},{where:{id:s}}),e.send("更新成功")):e.send("用户不存在")}async delete(e,t){const{id:s}=e.request.query;await n.findOne({where:{id:s}})?(await n.destroy({where:{id:s}}),e.send("删除成功")):e.send("用户不存在")}async findUserByName(e,t){const{nickname:s}=e.request.query,a=await n.findOne({where:{nickname:s}});a?e.send(a):e.send("用户不存在")}async findUserById(e,t){const{id:s}=e.request.query;let a=await n.findOne({where:{id:s}});a?e.send(a):e.send("用户不存在")}async findUser(e,t){const{id:s,nickname:a}=e.request.query;let i={};s&&(i.id=s),a&&(i.nickname=a);const r=await n.findAll({where:i});0!==r.length?e.send(r):e.send("用户不存在")}async addFile(e,t){const{name:s,url:n,owner:i}=e.request.body;await a.emptyCheck(s,"请输入文件名","name"),await a.emptyCheck(n,"请输入文件路径","url"),await a.emptyCheck(i,"请输入文件拥有者","owner"),await o.create({name:s,url:n,owner:i}),e.send("创建成功")}async getFilesByOwner(e,t){const{owner:s}=e.request.query;await a.emptyCheck(s,"请输入文件拥有者","owner");const n=await o.findAll({where:{owner:s}});0!==n.length?e.send(n):e.send("文件不存在")}async deleteFile(e,t){const{id:s}=e.request.query;await o.findOne({where:{id:s}})?(await o.destroy({where:{id:s}}),e.send("删除成功")):e.send("文件不存在")}}},608:(e,t,s)=>{const a=s(386),n=s(924),{Op:i}=s(31);e.exports=new class{async getUsers(e,t){const s=await n.findAll();e.send(s)}async updateUser(e,t){const{id:s}=e.request.query,{nickname:i,avatar:r,createdAt:o,updatedAt:d}=e.request.body;await a.emptyCheck(i,"请输入昵称","nickname"),await a.emptyCheck(r,"请输入头像","avatar"),await a.emptyCheck(o,"请输入创建时间","created"),await a.emptyCheck(d,"请输入更新时间","updated"),await n.findOne({where:{id:s}})?(await n.update({nickname:i,avatar:r,createdAt:o,updatedAt:d},{where:{id:s}}),e.send("更新成功")):e.send("用户不存在")}async deleteUser(e,t){const{id:s}=e.request.query;await n.findOne({where:{id:s}})?(await n.destroy({where:{id:s}}),e.send("删除成功")):e.send("用户不存在")}async findUserByName(e,t){const{nickname:s}=e.request.query,a=await n.findAll({where:{nickname:s}});a?e.send(a):e.send("用户不存在")}async findUserById(e,t){const{id:s}=e.request.query,a=await n.findAll({where:{id:s}});a?e.send(a):e.send("用户不存在")}async findUserByTime(e,t){const{startTime:s,endTime:a}=e.request.query,r=await n.findAll({where:{createdAt:{[i.between]:[new Date(new Date(s).setHours(0,0,0,0)),new Date(new Date(a).setHours(23,59,59,999))]}}});0!==r.length?e.send(r):e.send("用户不存在")}async findUser(e,t){const{id:s,nickname:a,startTime:r,endTime:o}=e.request.query;let d={};s&&(d.id=s),a&&(d.nickname=a),r&&o&&(d.createdAt={[i.between]:[new Date(new Date(r).setHours(0,0,0,0)),new Date(new Date(o).setHours(23,59,59,999))]});const c=await n.findAll({where:d});0!==c.length?e.send(c):e.send("用户不存在")}async getRecords(e,t){const{id:s}=e.request.query,a=`chat:${(await n.findOne({where:{id:s}})).openid}`,i=await e.redis.zrevrange(a,0,-1);let r=new Map;for(const e of i){const t=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8);r.has(t)?r.set(t,r.get(t)+1):r.set(t,1)}e.send(Object.fromEntries(r))}}},677:(e,t,s)=>{const a=s(386),n=s(667),{Op:i}=s(31);e.exports=new class{async getUsers(e,t){const s=await n.findAll();e.send(s)}async updateUser(e,t){const{id:s}=e.request.query,{email:i,avatar:r,createdAt:o,updatedAt:d}=e.request.body;await a.emptyCheck(i,"请输入邮箱","email"),await a.emptyCheck(r,"请输入头像","avatar"),await a.emptyCheck(o,"请输入创建时间","created"),await a.emptyCheck(d,"请输入更新时间","updated"),await n.findOne({where:{id:s}})?await n.findOne({where:{email:i}})?e.send("邮箱已存在"):(await n.update({email:i,avatar:r,createdAt:o,updatedAt:d},{where:{id:s}}),e.send("更新成功")):e.send("用户不存在")}async deleteUser(e,t){const{id:s}=e.request.query;await n.findOne({where:{id:s}})?(await n.destroy({where:{id:s}}),e.send("删除成功")):e.send("用户不存在")}async findUserByEmail(e,t){const{email:s}=e.request.query,a=await n.findAll({where:{email:s}});a?e.send(a):e.send("用户不存在")}async findUserById(e,t){const{id:s}=e.request.query,a=await n.findAll({where:{id:s}});a?e.send(a):e.send("用户不存在")}async findUserByTime(e,t){const{startTime:s,endTime:a}=e.request.query,r=await n.findAll({where:{createdAt:{[i.between]:[new Date(new Date(s).setHours(0,0,0,0)),new Date(new Date(a).setHours(23,59,59,999))]}}});0!==r.length?e.send(r):e.send("用户不存在")}async findUser(e,t){const{id:s,email:a,startTime:r,endTime:o}=e.request.query;console.log(s,a,r,o,"id, email, startTime, endTime");let d={};s&&(d.id=s),a&&(d.email=a),r&&o&&(console.log(r,o),d.createdAt={[i.between]:[new Date(new Date(r).setHours(0,0,0,0)),new Date(new Date(o).setHours(23,59,59,999))]});const c=await n.findAll({where:d});0!==c.length?e.send(c):e.send("用户不存在")}async getRecords(e,t){const{id:s}=e.request.query,a=`chat:${(await n.findOne({where:{id:s}})).email}`,i=await e.redis.zrevrange(a,0,-1);let r=new Map;for(const e of i){const t=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8);r.has(t)?r.set(t,r.get(t)+1):r.set(t,1)}e.send(Object.fromEntries(r))}}},348:(e,t,s)=>{const a=s(386),n=s(293),i=s(982),r=s(639);e.exports=new class{async saveChatHistory(e){const{messages:t,sessionId:s}=e.request.body;await a.arrayCheck(t,"请上传聊天记录","messages");let o="";o=s||n().format("YYYYMMDD")+n().format("HHmmssSSS");const d=e.auth.uid,c=n().format("YYYY-MM-DD"),l=n().valueOf(),m=`chat:${d}`,u=i.randomUUID(),y=JSON.stringify({time:c,messageId:u,...t});e.redis.zadd(m,l,o);const w=`chat:${d}:${o}`;if(e.redis.zadd(w,l,y),s)e.send();else{const t=await new r(e).newChatHistory(d,o);e.send(t)}}async fetchChatHistory(e){const t=e.auth.uid,s=`chat:${t}`,a=await e.redis.zrevrange(s,0,-1);let n=[];for(const s of a){const a=(await e.redis.zrange(`chat:${t}:${s}`,0,-1)).map((e=>JSON.parse(e)))[0],i=a.time,r={session_id:s,message:[{content:a[0].content,role:a[0].role}],time:i};n.push(r)}e.send(n)}async onliChatHistory(e){const{sessionId:t}=e.query;await a.undefinedCheck(t,"缺少会话id值","sessionId");const s=`chat:${e.auth.uid}:${t}`,n=(await e.redis.zrange(s,0,-1)).map((e=>JSON.parse(e))),i=[];n.forEach((e=>{Object.keys(e).forEach((t=>{"time"!==t&&"messageId"!==t&&i.push(e[t])}))})),e.send(i)}}},959:(e,t,s)=>{const a=s(386),n=s(924),i=s(682),r=s(529);e.exports=new class{async login(e,t){const{nickName:s,avatar:o,code:d}=e.request.body;await a.emptyCheck(s,"请输入昵称","nickName"),await a.emptyCheck(o,"请上传头像","avatar"),await a.emptyCheck(d,"缺少code","code"),console.log(s,o,d);const c=await(new i).getOpenid(d);await n.findOne({where:{openid:c}})||(console.log("创建用户"),await n.create({openid:c,nickname:s,avatar:o})),console.log(c,"openid"),e.send({token:r(c),nickName:s,avatar:o})}}},316:(e,t,s)=>{var a=s(623).RPCClient;const{accessKeyID:n,accessKeySecret:i}=s(25).aliyun,r=s(293);var o=new a({accessKeyId:n,accessKeySecret:i,endpoint:"http://nls-meta.cn-shanghai.aliyuncs.com",apiVersion:"2019-02-28"});e.exports=new class{async aliToken(e){const t=await e.redis.get("aliToken");if(t)return e.send(t),!1;const s=await o.request("CreateToken");if(s.Token&&s.Token.Id){const t=s.Token.ExpireTime-r().unix();await e.redis.set("aliToken",s.Token.Id,"EX",t),e.send(s.Token.Id)}else e.send(null,500,"获取阿里云token失败",s)}}},221:(e,t,s)=>{const a=s(386),n=s(293),i=s(982),r=s(639);e.exports=new class{async saveChatHistory(e){const{messages:t,sessionId:s}=e.request.body;await a.arrayCheck(t,"请上传聊天记录","messages");let o="";o=s||n().format("YYYYMMDD")+n().format("HHmmssSSS");const d=e.auth.uid,c=n().format("YYYY-MM-DD"),l=n().valueOf(),m=`chat:${d}`,u=i.randomUUID(),y=JSON.stringify({time:c,messageId:u,...t});e.redis.zadd(m,l,o);const w=`chat:${d}:${o}`;if(e.redis.zadd(w,l,y),s)e.send();else{const t=await new r(e).newChatHistory(d,o);e.send(t)}}async fetchChatHistory(e){const t=e.auth.uid,s=`chat:${t}`,a=await e.redis.zrevrange(s,0,-1);let n=[];for(const s of a){const a=(await e.redis.zrange(`chat:${t}:${s}`,0,-1)).map((e=>JSON.parse(e)))[0],i=a.time,r={session_id:s,message:[{content:a[0].content,role:a[0].role}],time:i};n.push(r)}e.send(n)}async onliChatHistory(e){const{sessionId:t}=e.query;await a.undefinedCheck(t,"缺少会话id值","sessionId");const s=`chat:${e.auth.uid}:${t}`,n=(await e.redis.zrange(s,0,-1)).map((e=>JSON.parse(e))),i=[];n.forEach((e=>{Object.keys(e).forEach((t=>{"time"!==t&&"messageId"!==t&&i.push(e[t])}))})),e.send(i)}async deleteChatHistory(e){const{sessionId:t}=e.query;await a.undefinedCheck(t,"缺少会话id值","sessionId");const s=e.auth.uid,n=`chat:${s}`,i=`chat:${s}:${t}`;await e.redis.del(i),await e.redis.zrem(n,t),e.send("success")}}},468:(e,t,s)=>{const a=s(386),n=s(667),i=s(529);e.exports=new class{async login(e,t){let s=-1;const{email:r,password:o}=e.request.body;await a.emptyCheck(r,"请输入邮箱","email"),await a.emptyCheck(o,"请输入密码","password");const d=await n.findOne({where:{email:r}});if(!d)return s=(await n.create({email:r,password:o,avatar:"https://kecheng-chabaidao.oss-cn-hangzhou.aliyuncs.com/kecheng/1736844800237248.jpeg"})).id,void e.send({token:i(r),id:s,email:r,avatar});if(d.password!==o||d.email!==r)e.send("密码错误");else{s=d.id;const{avatar:t}=d;e.send({token:i(r),id:s,email:r,avatar:t})}}}},163:(e,t,s)=>{const{ZhipuAI:a}=s(304),{apiKey:n}=s(25).zhipu,i=s(386),r=new a({apiKey:n});e.exports=new class{async createCompletions(e){const{messages:t}=e.request.body;await i.arrayCheck(t,"缺少对话信息","messages");const s=await r.createCompletions({model:"glm-4-flash",messages:t,stream:!0,tools:[{type:"web_search",web_search:{enable:!0,search_result:!1}}]});e.status=200;for await(const t of s)e.res.write(t)}async createImages(e){const{prompt:t}=e.request.body;await i.emptyCheck(t,"请输入图像的文本描述","prompt");const s=await r.createImages({model:"cogview-3-flash",prompt:t});e.send({url:s.data[0].url,prompt:"我已为你生成对应的图片,你可以继续问我!"})}}},346:(e,t,s)=>{const{ZhipuAI:a}=s(304),{apiKey:n}=s(25).zhipu,i=s(386),r=new a({apiKey:n});e.exports=new class{async createCompletions(e){const{messages:t}=e.request.body;await i.arrayCheck(t,"缺少对话信息","messages");const s=await r.createCompletions({model:"glm-4-flash",messages:t,stream:!0,tools:[{type:"web_search",web_search:{enable:!0,search_result:!1}}]});e.status=200;for await(const t of s)e.res.write(t)}async createImages(e){const{prompt:t}=e.request.body;await i.emptyCheck(t,"请输入图像的文本描述","prompt");const s=await r.createImages({model:"cogview-3-flash",prompt:t});e.send({url:s.data[0].url,prompt:"我已为你生成对应的图片,你可以继续问我!"})}}},629:(e,t,s)=>{const a=s(977),n={trace:a.levels.TRACE,debug:a.levels.DEBUG,info:a.levels.INFO,warn:a.levels.WARN,error:a.levels.ERROR,fatal:a.levels.FATAL};a.configure({appenders:{console:{type:"console"},info:{type:"file",filename:"logs/info-logs.log"},error:{type:"dateFile",filename:"logs/error",pattern:"yyyy-MM-dd.log",alwaysIncludePattern:!0}},categories:{default:{appenders:["console"],level:"debug"},info:{appenders:["info","console"],level:"info"},error:{appenders:["error","console"],level:"error"}}}),t.debug=e=>{let t=a.getLogger("debug");t.level=n.debug,t.debug(e)},t.info=e=>{let t=a.getLogger("info");t.level=n.info,t.info(e)},t.warn=e=>{let t=a.getLogger("warn");t.level=n.warn,t.warn(e)},t.error=e=>{let t=a.getLogger("error");t.level=n.error,t.error(e)}},333:(e,t,s)=>{const a=s(136),{DataTypes:n}=s(31),i=a.define("file-admin",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},name:{type:n.STRING,allowNull:!1},url:{type:n.STRING,allowNull:!1},owner:{type:n.STRING,allowNull:!1}});e.exports=i},411:(e,t,s)=>{const a=s(136),{DataTypes:n}=s(31),i=a.define("role-admin",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},name:{type:n.STRING,unique:!0,allowNull:!1},permission:{type:n.STRING,allowNull:!1}});e.exports=i},268:(e,t,s)=>{const a=s(136),{DataTypes:n}=s(31),i=a.define("user-admin",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},nickname:{type:n.STRING,allowNull:!1},email:{type:n.STRING,allowNull:!1,unique:!0},password:{type:n.STRING,allowNull:!1},role:{type:n.STRING,allowNull:!1},avatar:{type:n.STRING,allowNull:!0},phone:{type:n.STRING,allowNull:!0}});e.exports=i},924:(e,t,s)=>{const a=s(136),{DataTypes:n}=s(31),i=(s(293),a.define("user-info",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},nickname:{type:n.STRING,allowNull:!1},avatar:{type:n.STRING,allowNull:!1},openid:{type:n.STRING,allowNull:!1,unique:!0}}));e.exports=i},667:(e,t,s)=>{const a=s(136),{DataTypes:n}=s(31),i=a.define("user-web",{id:{type:n.INTEGER,primaryKey:!0,autoIncrement:!0},email:{type:n.STRING,allowNull:!1,unique:!0},password:{type:n.STRING,allowNull:!1},avatar:{type:n.STRING,allowNull:!0}});e.exports=i},692:(e,t,s)=>{const a=s(643),n=s(959),i=s(346),r=s(316),o=s(348),d=s(332),c=new a;c.post("/login",n.login),c.post("/createCompletions",i.createCompletions),c.post("/createImages",d,i.createImages),c.get("/alitoken",r.aliToken),c.post("/save-chat-history",d,o.saveChatHistory),c.get("/fetch-chat-history",d,o.fetchChatHistory),c.get("/only-chat-history",d,o.onliChatHistory);const l=s(468),m=s(163),u=s(221);c.post("/web/login",l.login),c.post("/web/createCompletions",d,m.createCompletions),c.post("/web/createImages",d,m.createImages),c.post("/web/save-chat-history",d,u.saveChatHistory),c.get("/web/fetch-chat-history",d,u.fetchChatHistory),c.get("/web/only-chat-history",d,u.onliChatHistory),c.delete("/web/delete-chat-history",d,u.deleteChatHistory);const y=s(603),w=s(608),p=s(808),h=s(677);c.post("/admin/login",y.login),c.get("/admin/getUsers",d,y.getUsers),c.post("/admin/update",d,y.update),c.delete("/admin/delete",d,y.delete),c.get("/admin/findUserByName",d,y.findUserByName),c.get("/admin/findUserById",d,y.findUserById),c.get("/admin/findUser",d,y.findUser),c.get("/admin/getUserInfo",d,y.getUserInfo),c.post("/admin/addFile",d,y.addFile),c.get("/admin/getFiles",d,y.getFilesByOwner),c.delete("/admin/deleteFile",d,y.deleteFile),c.get("/admin/getUsersWX",d,w.getUsers),c.post("/admin/updateWX",d,w.updateUser),c.delete("/admin/deleteWX",d,w.deleteUser),c.get("/admin/findUserWXByName",d,w.findUserByName),c.get("/admin/findUserWXById",d,w.findUserById),c.get("/admin/findUserWXByTime",d,w.findUserByTime),c.get("/admin/findUserWX",d,w.findUser),c.get("/admin/getRecords",d,w.getRecords),c.get("/admin/getUsersWeb",d,h.getUsers),c.post("/admin/updateWeb",d,h.updateUser),c.delete("/admin/deleteWeb",d,h.deleteUser),c.get("/admin/findUserWebByEmail",d,h.findUserByEmail),c.get("/admin/findUserWebById",d,h.findUserById),c.get("/admin/findUserWebByTime",d,h.findUserByTime),c.get("/admin/findUserWeb",d,h.findUser),c.get("/admin/getUserWebRecords",d,h.getRecords),c.post("/admin/addRole",d,p.addRole),c.get("/admin/getRoles",d,p.getRoles),c.post("/admin/updateRole",d,p.updateRole),c.delete("/admin/deleteRole",d,p.deleteRole),c.get("/admin/findRoleByName",d,p.findRoleByName),c.get("/admin/findRoleById",d,p.getRole),c.get("/admin/findRole",d,p.findRole),e.exports=c},639:e=>{e.exports=class{constructor(e){this.ctx=e}async newChatHistory(e,t){const s=(await this.ctx.redis.zrange(`chat:${e}:${t}`,0,-1)).map((e=>JSON.parse(e)))[0],a=s.time;return{session_id:t,message:[{content:s[0].content,role:s[0].role}],time:a}}}},682:(e,t,s)=>{const{appid:a,secret:n,code2session:i}=s(25).weixin,r=s(480),o=s(938);s(924),e.exports=class{async getOpenid(e){const t=r.stringify({appid:a,secret:n,js_code:e,grant_type:"authorization_code"}),s=await o.get(`${i}?${t}`);if(s.data.errcode)throw{msg:"获取code出错",code:400,error:s.data};return s.data.openid}}},386:e=>{e.exports=new class{async undefinedCheck(e,t){if(void 0===e)throw console.log("校验不通过"),{msg:`${t}字段必填`,code:400}}async emptyCheck(e,t,s){if(await this.undefinedCheck(e,s),"string"!=typeof e)throw{msg:`${s}字段必须为字符串类型`,code:400};if(""===e.trim())throw{msg:t,code:422}}async arrayCheck(e,t,s){if(await this.undefinedCheck(e,s),!Array.isArray(e))throw{msg:`${s}字段必须为数组类型`,code:400};if(e.length<=0)throw{msg:t,code:422}}}},623:e=>{"use strict";e.exports=require("@alicloud/pop-core")},695:e=>{"use strict";e.exports=require("@koa/cors")},643:e=>{"use strict";e.exports=require("@koa/router")},938:e=>{"use strict";e.exports=require("axios")},699:e=>{"use strict";e.exports=require("basic-auth")},293:e=>{"use strict";e.exports=require("dayjs")},659:e=>{"use strict";e.exports=require("ioredis")},829:e=>{"use strict";e.exports=require("jsonwebtoken")},101:e=>{"use strict";e.exports=require("koa")},911:e=>{"use strict";e.exports=require("koa-bodyparser")},546:e=>{"use strict";e.exports=require("koa-json")},977:e=>{"use strict";e.exports=require("log4js")},577:e=>{"use strict";e.exports=require("module-alias")},31:e=>{"use strict";e.exports=require("sequelize")},304:e=>{"use strict";e.exports=require("zhipuai-sdk-nodejs-v4")},982:e=>{"use strict";e.exports=require("crypto")},480:e=>{"use strict";e.exports=require("querystring")}},t={};function s(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}const a=s(101),n=s(546),i=s(911),r=s(695),o=s(659),{addAliases:d}=s(577);d({"@":__dirname});const c=s(692),l=s(145),m=s(228),u=new a;u.use(r()),u.use(n()),u.use(i()),u.use(l),u.use(m);const{port:y,host:w,password:p}=s(25).redisInfo,h=new o({port:y,host:w,password:p});u.use((async(e,t)=>{e.redis=h,await t()})),u.use(c.routes()).use(c.allowedMethods()),u.listen(3e3,(()=>{console.log("Server is running on port 3000")}))})();